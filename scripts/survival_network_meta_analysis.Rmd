
---
title: "Survival and Network Meta-Analysis Example"
author: "Yolande Tra"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This document demonstrates how to perform survival analysis and network meta-analysis using simulated clinical trial data comparing treatments A, B, and C.

## Load Required Libraries

```{r libraries}
library(survival)
library(netmeta)
library(dplyr)
library(tidyr)
library(ggplot2)
```

## Read the Simulated Dataset

```{r read-data}
data <- read.csv("simulated_survival_data.csv")
head(data)
```

## Fit a Cox Proportional Hazards Model

We use a Cox model to evaluate the effect of treatment and age on survival.

```{r cox-model}
cox_model <- coxph(Surv(time, event) ~ treatment + age, data = data)
summary(cox_model)
```

## Summarize Event Counts and Person-Time by Treatment

This helps us prepare inputs for network meta-analysis.

```{r summarize-data}
summary_table <- data %>%
  group_by(study_id, treatment) %>%
  summarise(events = sum(event),
            person_time = sum(time),
            .groups = 'drop')
summary_table
```

## Prepare Pairwise Treatment Comparisons

This step formats the data for use with the `netmeta` package.

```{r pairwise-comparisons}
pw_data <- pairwise(treat = treatment,
                    event = event,
                    n = rep(100, nrow(data)),
                    studlab = study_id,
                    data = data,
                    sm = "HR")
```

## Conduct Network Meta-Analysis

We now use the network meta-analysis function to estimate relative hazard ratios.

```{r network-meta}
net <- netmeta(TE = pw_data$TE,
               seTE = pw_data$seTE,
               treat1 = pw_data$treat1,
               treat2 = pw_data$treat2,
               studlab = pw_data$studlab,
               sm = "HR",
               comb.fixed = TRUE,
               comb.random = TRUE)
summary(net)
```

## Plot Network Graph

Visualize the network of treatment comparisons.

```{r plot-network}
netgraph(net, thickness = "seTE", multiarm = TRUE)
```

## Forest Plot of Results

```{r forest-plot}
forest(net, ref = "A")
```

## Conclusion

This project illustrates how to conduct a network meta-analysis with simulated survival data. It is a helpful exercise for building experience in HEOR and comparative effectiveness research.
