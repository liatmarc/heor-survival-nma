---
title: "Network Meta-Analysis Using Summary Log(HR) Data"
author: "Yolande Tra"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
    highlight: tango
    theme: readable
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This R Markdown demonstrates how to perform a network meta-analysis using study-level summary statistics (log hazard ratios and standard errors).

## Load Required Libraries

```{r libraries}
library(netmeta)
```

## Read Summary Data

```{r read-summary}
nma_data <- read.csv("C:/Users/trani/OneDrive/heor-survival-nma/data/nma_summary_loghr_data.csv")
print(nma_data)
```

## Perform Network Meta-Analysis

```{r netmeta-analysis}
net <- netmeta(TE = nma_data$logHR,
               seTE = nma_data$SE,
               treat1 = nma_data$treat1,
               treat2 = nma_data$treat2,
               studlab = nma_data$study_id,
               sm = "HR",
               comb.fixed = TRUE,
               comb.random = TRUE)
summary(net)
```

## Plot the Treatment Network and Forest Plot

```{r plot-network}
netgraph(net, thickness = "seTE", multiarm = TRUE)
```

```{r forest-plot}
forest(net, ref = "A")
```

## Conclusion

This workflow demonstrates a simplified example of survival-based network meta-analysis using log(HR) and standard errors from Cox models across studies.

## Ranking Treatments and Multiple Comparison Considerations

When comparing multiple treatments, there's an increased risk of Type I error (false positives). Traditional pairwise comparisons would require p-value adjustments (e.g., Bonferroni correction), but in network meta-analysis, such corrections are not commonly applied for two reasons:

1. Treatment effects are not independent (due to shared indirect evidence).
2. Adjustments would reduce statistical power significantly.

Instead, network meta-analysis relies on:
- Confidence intervals around hazard ratios
- Global consistency/inconsistency checks
- Treatment ranking using model-based scores

### Compute Treatment Rankings with P-scores

```{r treatment-ranking}
netrank(net)
```

P-scores are the frequentist analog of SUCRA (used in Bayesian NMA). They range from 0 (worst) to 1 (best). Higher scores indicate more favorable treatments.

### View All Pairwise Comparisons (League Table)

```{r league-table}
netleague(net, digits = 2)
```

This table presents all possible pairwise treatment comparisons, including those not shown in the default forest plot. It includes estimated hazard ratios and their confidence intervals based on the network model.